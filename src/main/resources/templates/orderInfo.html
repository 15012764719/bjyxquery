<!DOCTYPE html>
<html lang="en" xmlns:text-align="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>北京生产业务辅助系统</title>
<!--    <title>北京生鲜业务系统</title>-->
    <!-- <meta http-equiv="refresh" content="60">-->
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Bluth Company" name="author">
    <link href="ico/favicon.html" rel="../static/shortcut icon">
    <link href="css/theme.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/alertify.css" rel="stylesheet">
    <link href="favicon.ico" rel="Favicon Icon">
    <link href="css/alertify.css" rel="stylesheet">
    <link href="css/bootstrap-table.min.css" rel="stylesheet">
    <link href="layui/css/layui.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/bootstrap.css}"></link>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>

<br/>
<h3 align="center">北京生鲜业务系统</h3>
<div id="wrapData" width="90%">
    <div class="panel-heading text-center">
        <span class="panel-title"><h3>您好:[[${session.user.username}]]</h3></span>
    </div>
    <div class="panel-heading text-center">
<!--        <span class="panel-title"><h3>余额:<span id="remainingSum"> [[${session.user.remainingSum}]]</span></h3></span>-->
<!--        <span class="panel-title"><h3>余额:<span id="remainingSum">[[${remainingSum}]]</span><span>元</span></h3></span>-->
    </div>
    <div class="container-fluid" th:align="center">
<!--        <form action="/upload" method="POST" enctype="multipart/form-data">-->
<!--            <input type="file" name="file" ><br>-->
<!--            <input type="submit" value="上传">-->
<!--        </form>-->
        <input  type="file" name="file" id="file">
        <input  class="btn btn-info " type="button" id="uploadButton" value="上传">
        <span>批次号:</span>
        <input  type="text" readonly="readonly" name="bathNo" id="bathNo">
<!--        <button id="dowloadBtn" class="btn btn-info " type="button"><i class="fa fa-trash-o"></i> 当前结果下载</button>-->
    </div>
<!--    <div class="layui-inline">-->
<!--        <label class="layui-form-label">日期时间范围</label>-->
<!--        <div class="layui-input-inline">-->
<!--            <input type="text" class="layui-input" id="test10" placeholder=" - ">-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class='layui-form'>-->
<!--        <div class="layui-form-item">-->
<!--            <div class="layui-inline">-->
<!--                <label class="layui-form-label">起始日期：</label>-->
<!--                <input type="text" class="layui-input" id="startdatepicker" autocomplete="off" />-->

<!--            </div>-->
<!--            <div class="layui-inline">-->
<!--                <label class="layui-form-label">截止日期：</label>-->
<!--                <input type="text" class="layui-input" id="enddatepicker" autocomplete="off" />-->
<!--            </div>-->
<!--            <button class="layui-btn" data-type="reload">搜索</button>-->
<!--        </div>-->
<!--    </div>-->

        <br/>
        <br/>
</div>


<script src="js/jquery.min.js" type="text/javascript"></script>
<script src="js/jquery-ui.min.js" type="text/javascript"></script>
<script src="js/raphael-min.js" type="text/javascript"></script>
<script src="js/bootstrap.js" type="text/javascript"></script>
<script src='js/sparkline.js' type="text/javascript"></script>
<script src='js/morris.min.js' type="text/javascript"></script>
<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="js/jquery.masonry.min.js" type="text/javascript"></script>
<script src="js/jquery.imagesloaded.min.js" type="text/javascript"></script>
<script src="js/jquery.facybox.js" type="text/javascript"></script>
<script src="js/jquery.alertify.min.js" type="text/javascript"></script>
<script src="js/jquery.knob.js" type="text/javascript"></script>
<script src='js/fullcalendar.min.js' type='text/javascript'></script>
<script src='js/jquery.gritter.min.js' type='text/javascript'></script>
<script src="js/realm.js" type="text/javascript"></script>
<script src="js/bootstrap-table.min.js"></script>
<script src="js/bootstrap-table-zh-CN.min.js"></script>
<script src="layui/layui.all.js"></script>

<script type="text/javascript">
    $(function () {
        $("#uploadButton").click(function () {
            var file = $("#file").val();
            if (file == null || file == "") {
                alert("请选择导入文件");
                return;
            }
            var formData = new FormData();
            formData.append('file', $('#file')[0].files[0]);
            $.ajax({
                dataType: "json",
                type: "POST",
                url: '/uploadOrderOriginal',
                data: formData,
                contentType: false,//必须false才会自closeLoading();动加上正确的Content-Type
                processData: false,//必须false才会避开jQuery对 formdata 的默认处理XMLHttpRequest会对 formdata 进行正确的处理
                success: function (data) {
                    // alert(data.msg);
                    // $("#fileName").val(data.msg);
                    if(data.code==1){
                       msgs = data.msg.split(",");
                        alert("上传成功,共导入"+msgs[1]+"条数据")
                        $("#bathNo").val(msgs[0]);
                    }
                   if(data.code==0){
                       alert(data.msg)
                   }
                },
                error: function (er) {          //失败，回调函数
                    alert("eer"+data.msg);
                }
            });
        });
    });

    $("#dowloadBtn").on("click",function () {

        var fileName = $("#fileName").val();
        if (fileName == null || fileName == "") {
            alert("没有当前正在导入的数据！");
            return;
        }
        window.location.href="/download?fileName="+ $("#fileName").val();
        // $.ajax({
        //     url:"/download?fileName="+ $("#fileName").val(),
        //     type:"get",
        //     success:function (date) {
        //
        //     },
        //     error:function () {
        //         alert("error")
        //     }
        // })
    });

    function downloadFile(fileName) {

        window.location.href="/download?fileName="+ fileName;
    }

</script>
</body>
</html>
